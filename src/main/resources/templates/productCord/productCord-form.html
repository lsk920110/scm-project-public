<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head th:replace="common/fragments/config-fragment :: ConfigFragment">
<body>
<th:block th:replace="common/fragments/left-navbar" :: LeftNavbarFragment></th:block>
<th:block th:replace="common/fragments/header-fragment" :: headerFragment></th:block>
<div class="content-area">
    <h2>코드관리</h2>
    <hr>
    <form action="/productCord" method="post">

        <div style="padding-bottom: 5px;">
            <select name="vendor" id="vendor-select" class="form-select">
                <option th:each="vendor : ${vendorList}"
                        th:text="${vendor.vendorName}"
                        th:value="${vendor.id}"
                ></option>
            </select>
            <label for="vendor-select"></label>
        </div>
        <div style="padding-bottom: 10px;">
            <select name="productCategory" class="form-select">
                <option value="0">카테고리를 선택해주세요</option>
                <option th:each="productCategory : ${productCategoryList}"
                        th:value="${productCategory.id}"
                        th:text="${productCategory.productCategory}"></option>
            </select>
        </div>
<!--        productCategory 선택시 관련된 코드들을 불러옴 -->
        <script>
            $('select[name="productCategory"]').change(function(e){
                // const vendorId = $('#vendor-select').val();
                $.ajax({
                    url : `/api/product/model?productCategoryId=${this.value}`,
                    method : 'GET',
                    dataType : 'json',
                    success : (result)=>{
                        console.log(result);
                        let txt = result.result.length === 0
                            ? '<option>등록된 모델이 없습니다.</option>' : '';

                        result.result.forEach((item,idx)=>{
                            txt += `<option value="${item.id}">${item.modelCord}</option>`;
                        })

                        $('select[name="productModel"]').empty();
                        $('select[name="productModel"]').append(txt);
                    },
                    error : ()=>{}
                })

            })
        </script>
        <div>
            <select name="productModel" class="form-select">
                <option>-----</option>
            </select>
        </div>
        <div class="d-grid gap-2">
            <input placeholder="" class="form-control" name="stock" id="supply-price" type="number" min="0">
            <label for="supply-price"></label>
        </div>
        <div class="d-grid gap-2">
            <input placeholder="" class="form-control" name="stock" id="supply-price-vat" type="number" min="0">
            <label for="supply-price-vat"></label>
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="inputGroup-supply-price">공급가</span>
            <input type="number" name="supply-price" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-supply-price">
        </div>
        <script>
            $('input[name="supply-price"]').keyup(function(){
                this.value
                $('input[name="supply-price-vat"]').val(Math.ceil(this.value / 10));
            });

        </script>
        <div class="input-group mb-3">
            <span class="input-group-text" id="inputGroup-supply-price-vat">부가세</span>
            <input disabled type="number" name="supply-price-vat" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-supply-price-vat">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="total-price">금액</span>
            <input disabled type="number" name="total-price" class="form-control" aria-label="Sizing example input" aria-describedby="total-price">
        </div>
        <div class="form-floating mb-3">
            <input name="modelCord" id="productModel" class="form-control" type="text">
            <label for="productModel">제품코드를 입력하세요</label>
        </div>
        <div class="d-grid gap-2">
            <button class="btn btn-primary">저장</button>
        </div>
    </form>
    <div style="height : 15px;"></div>
    <table class="table">
        <thead>
        <tr>
            <th>id</th>
            <th>카테고리</th>
            <th>모델코드</th>
            <th>재고량</th>
            <th>출시상태</th>
            <th>등록자</th>
            <th>등록일자</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="productModel : ${productModelList}">
            <td th:text="${productModel.id}" aria-label="아이디"></td>
            <td th:text="${productModel.productCategory}" aria-label="카데고리"></td>
            <td th:text="${productModel.modelCord}" aria-label="모델코드"></td>
            <td th:text="${productModel.stock}" aria-label="재고량"></td>
            <td aria-label="출시상태">
                <select class="form-select">
                    <option th:each="productStatus : ${productStatusList}"
                            th:value="${productStatus.id}"
                            th:text="${productStatus.productStatus}"
                            th:selected="${productStatus.id} == ${productModel.productStatusId}"
                    ></option>
                </select>
            </td>
            <td th:text="${productModel.name}" aria-label="등록자"></td>
            <td th:text="${productModel.regDt}" aria-label="등록일"></td>
        </tr>
        </tbody>
    </table>
</div>

</body>
</html>