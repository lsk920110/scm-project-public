<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head th:replace="common/fragments/config-fragment :: ConfigFragment">
    <!--    <title layout:title-pattern="$LAYOUT_TITLE : $CONTENT_TITLE">공통 타이틀</title>-->
</head>
<body>
<th:block th:replace="common/fragments/left-navbar" :: LeftNavbarFragment></th:block>
<th:block th:replace="common/fragments/header-fragment" :: headerFragment></th:block>
<script>
    const updateOrderNum =()=>{
        const $menuId = $('.menuId');
        let menuIdList = [];
        for (let i = 0; i < $menuId.length; i++) {
            menuIdList.push($menuId[i].innerText)
        }
        console.log(menuIdList);
        $.ajax({
            type : 'post',
            url : '/api/menubar/orderSeq',
            data : JSON.stringify({menuIdList : menuIdList}),
            dataType : 'json',
            contentType : 'application/json',
            success : (result)=>{
                console.log(result);
            },
            error : (err)=>{
                console.log(err)
            }
        })
    }
    const moveUp =(e)=>{
        let $tr = $(e).parent().parent().parent();
        $tr.prev().before($tr);
        updateOrderNum();
    }
    const moveDown =(e)=>{
        let $tr = $(e).parent().parent().parent();
        $tr.next().after($tr);
        updateOrderNum();
    }
    const deleteMenu=(id)=>{
        if(confirm('해당 메뉴를 삭제하시겠습니까?')){
            $.ajax({
                type : 'post',
                contentType : 'application/json',
                url : '/api/menubar/delete',
                data : JSON.stringify({
                    menuId : id
                }),
                dataType : 'json',
                success : function(result){
                    alert('삭제완료');
                    location.reload();
                },
                error : function(e){console.log(e)}
            })
        }
    }
</script>
<div class="content-area">
    <h2>메뉴관리</h2>
    <hr>
    <form action="/menubar/registration" method="post">

        <div style="width : 500px;" class="input-group mb-3">
            <span style="width : 100px;" class="input-group-text" id="basic-addon1">기 능 명</span>
            <input name="menuTitle" type="text" class="form-control" placeholder="ex) 발주관리 , 주문관리"
                   aria-label="function-name" aria-describedby="basic-addon1">
        </div>
        <div style="width : 500px;" class="input-group mb-3">
            <span style="width : 100px;" class="input-group-text" id="basic-addon2">상대 URL</span>
            <input name="link" type="text" class="form-control" placeholder="ex) /api/user , /order/registration"
                   aria-label="relative-url" aria-describedby="basic-addon2">
        </div>
        <div class="form-check">
            <input value="1" class="form-check-input" type="radio" name="position" id="flexRadioDefault1" checked>
            <label class="form-check-label" for="flexRadioDefault1">
                사이드바
            </label>
        </div>
        <input value="2" class="form-check-input" type="radio" name="position" id="flexRadioDefault2">
        <label class="form-check-label" for="flexRadioDefault2">
            헤더
        </label>
        <div class="form-check">
        </div>
        <div class="d-grid gap-2 col-6 mx-auto">
            <button class="btn btn-primary" type="submit">저장</button>
        </div>
    </form>
    <div>
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a th:class="'nav-link '+${position == '1' ? 'active' : ''}" class="nav-link active" aria-current="page" href="/menubar/management?position=1">사이드바</a>
            </li>
            <li class="nav-item">
                <a th:class="'nav-link '+${position == '2' ? 'active' : ''}" class="nav-link" href="/menubar/management?position=2">헤더</a>
            </li>
        </ul>
        <table class="table">
            <thead>
            <tr>
                <th>#</th>
                <th>기능</th>
                <th>URL</th>
                <th>위치</th>
                <th>상태</th>
                <th>순서</th>
                <th>삭제</th>
<!--                <th>수정</th>-->
            </tr>
            </thead>
            <tbody>
            <tr th:each="menu : ${menubars}">
                <td class="menuId" th:text="${menu.id}"></td>
                <td th:text="${menu.menuTitle}"></td>
                <td th:text="${menu.link}"></td>
                <td>
                    <label>
                        <select class="form-select" th:classappend="'position-'+${menu.id}">
                            <option th:selected="${menu.position == '1'}" th:value="1" th:text="사이드"></option>
                            <option th:selected="${menu.position == '2'}" th:value="2" th:text="상단"></option>
                        </select>
                    </label>
                </td>
                <td>
                    <div class="form-check form-switch">
                        <input th:checked="${menu.state == '1'}" class="form-check-input" th:classappend="'state-'+${menu.id}" type="checkbox" role="switch">
                    </div>
<!--                    <label>-->
<!--                        <select class="form-select" th:classappend="'state-'+${menu.id}">-->
<!--                            <option th:selected="${menu.state == '1'}" th:value="1" th:text="사용"></option>-->
<!--                            <option th:selected="${menu.state == '2'}" th:value="2" th:text="미사용"></option>-->
<!--                        </select>-->
<!--                    </label>-->
                </td>
                <td>

                    <div class="btn-group" role="group" aria-label="Default button group">
                        <button type="button" onclick="moveUp(this)" class="btn btn-outline-primary">⬆</button>
                        <button type="button" onclick="moveDown(this)" class="btn btn-outline-primary">⬇</button>
                    </div>
                </td>
                <td>
                    <button class="btn btn-primary" type="button" th:onclick="|deleteMenu(${menu.id})|">
                    삭제
                    </button>
                </td>

<!--                <td>-->
<!--                    <button class="btn btn-primary" th:onclick="|update(${menu.id})|">저장</button>-->
<!--                </td>-->
            </tr>
            </tbody>
            <tfoot></tfoot>
        </table>
    </div>
</div>
</body>
<script>
    function update(id){
        const position = $('.position-'+id).val();
        const state = $('.state-'+id).checked ? '1' : '2';
        const params = {
            id : id,
            state : state,
            position : position
        }
        $.ajax({
            method : 'put',
            url : '/menubar/update',
            data : JSON.stringify(params),
            contentType : 'application/json',
            dataType : 'json',
            success : (data)=>{
                console.log(data);
            },
            error : (e)=>{console.log(e);}
        })
    }
</script>
</html>